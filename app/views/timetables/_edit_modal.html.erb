<%# app/views/timetables/_edit_modal.html.erb %>
<h2><%= "#{grade}年 時間割編集" %></h2>

<table class="timetable edit-timetable">
  <thead>
    <tr>
      <th>時限</th>
      <% %w(月 火 水 木 金).each do |day| %>
        <th><%= day %></th>
      <% end %>
    </tr>
  </thead>

  <tbody>
    <% (1..3).each do |period| %>
      <tr>
        <td><%= "#{period}限" %></td>
        <% (1..5).each do |day| %>
          <% timetable = timetables.find { |t| t.day_of_week == day && t.period == period } %>
          <% 
            cell_class = ["editable-cell"]
            cell_class << "changed-cell" if timetable && !timetable.base_subject
            cell_class << "exam-cell" if timetable&.subject&.name&.start_with?("【試験】")
          %>
          <td 
            class="<%= cell_class.join(' ') %>" 
            data-timetable-id="<%= timetable&.id %>"
            data-day="<%= day %>"
            data-period="<%= period %>"
          >
            <%= timetable&.subject&.name&.gsub("【試験】", "") || "-" %>
          </td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>

<div style="display:none;" id="all-subjects" data-subjects='<%= all_subjects.to_json(only: [:id, :name]) %>'></div>